title: 时序模型初探之三：指数平均法
date: 2021-8-11 22:10:07
mathjax: true
tags:
- 算法
- 时序模型
categories:
- 编程
- 算法
keywords:
- 指数平滑法
- ES

---

### 简述

一般而言，历史数据对未来值的影响是随着时间地推移而递减的。所以，不同于移动平均法只关注时间序列中近$N$期数据对预测值的影响，指数平滑法对时间序列中所有的观测值依时间顺序进行加权平均作为预测值的作法，显得更切合实际。

<!-- more -->

### 三种常用预测模型

指数平滑法（Exponential Smoothing，ES），本质上是一种加权平均法，由于其加权系数符合指数规律，又具有平滑数据的功能，故称之为指数平滑法。

指数平滑法根据平滑次数的不同，可分为三种常用的预测模型，分别是：

- 一次指数平滑法
    - 预测模型
        
        设时间序列为$y_1,y_2,...,y_t$，加权系数为$\alpha，0 \lt \alpha \lt 1$，一次指数平滑公式为：
        
        <div>
        $$
        \begin{equation}
        S_t=\alpha y_t+(1-\alpha)S_{t-1}=S_{t-1}+\alpha(y_t-S_{t-1})
        \end{equation}
        $$
        </div>
        
        为进一步理解指数平滑的实质，将上式依次展开，可得：
        
        <div>
        $$
        \begin{equation}
        S_t=\alpha y_t + (1-\alpha)[\alpha y_{t-1}+(1-\alpha)S_{t-2}]=...=\alpha \sum_{j=0}^{\infty}(1-\alpha)^j y_{t-j}
        \end{equation}
        $$
        </div>
        
        由上式可知，$S_t$是对全部历史数据的加权平均值，加权系数分别是$\alpha,\alpha(1-\alpha),\alpha(1-\alpha)^2...,\alpha(1-\alpha)^j$，其预测模型为：
        
        <div>
        $$
        \begin{equation}
        \hat{y}_{t+1}=(1-\alpha)\hat{y}_t+\alpha y_t=\hat{y}_t+\alpha(y_t-\hat{y}_t)
        \end{equation}
        $$
        </div>
        
    - 加权系数的选择
        
        在指数平滑预测模型中，加权系数的选择决定了最终的预测结果。$\alpha$的值决定了在做新预测时新数据和原预测值所占的权重。$\alpha$值越大，新数据所占的权重越大，原始预测值所占的权重就越小，反之亦然。
        
        由式(3)可知，新预测值本质上是使用预测误差对原预测值进行修正后得到的，其中$\alpha$的值与修正的幅度成正比：
        
        1. 如果$\alpha=0$，则$\hat{y}_{t+1}=\hat{y}_t$，新预测值等于原预测值，即忽略新观测值，完全相信过去信息。
        2. 如果$\alpha=1$，则$\hat{y}_{t+1}=y_t$，新预测值等于新观察值，即忽略过去信息，完全相信新观测值。
        
        因此，$\alpha$的值应根据时间序列的具体性质在0~1之间选择。一般原则是：
        
        1. 如果时间序列波动不大，则$\alpha$的值应取小一点，e.g. 0.1~0.5之间
        2. 如果时间序列具有迅速且明显的变动倾向，则$\alpha$的值应取大一点，e.g. 0.6~0.8之间。这样预测模型更为灵敏，以便迅速响应变化。
        
        实际应用上，类似移动平均法，多取几个$\alpha$值，选其中预测误测最小的那个。
        
    - 初始值的选择
        
        在指数平滑预测模型中，除了选择合适的$\alpha$值，还要确定初始值$S_0$。初始值是由预测根据经验指定的。一般原则是：
        
        1. 如果时间序列的观测数据较多，初始值对以后的预测值影响很小，可选用第一期的观测值作为初始值。
        2. 如果时间序列的观测数据较少，初始值对以后的预测值影响较大，可选用最初几期观测值的平均值作为初始值。
- 二次指数平滑法
    
    一次指数平滑法适用于时间序列没有明显变动趋势的场景。但是当时间序列的变动出现线性变动趋势时，用一次指数平滑法进行预测的未来值会存在明显的滞后偏差，而线性趋势恰好体现在滞后偏差上。因此，二次指数平滑的思想是：一次指数平滑法得到的滞后偏差建立线性趋势模型。对一次指数平滑模型的预测结果进行修正，即进行二次移动平均，最终得到修正后预测值更接近实际情况。
    
    - 预测模型
        
        根据一次指数平滑法的计算公式:
        
        <div>
        $$
        \begin{equation}
        S^1_t=\alpha y_t+(1-\alpha)S^1_{t-1}
        \end{equation}
        $$
        </div>
        
        可得二次指数平滑法的计算公式为：
        
        <div>
        $$
        \begin{equation}
        S^2_t=\alpha S^1_t+(1-\alpha)S^2_{t-1}
        \end{equation}
        $$
        </div>
        
        其中，$S^1_t$为一次指数的平滑值，$S^2_t$为二次指数的平滑值。
        
        设时间序列$\{y_t\}$从某个时期开始呈现线性趋势，且线性趋势会延续到未来，其线性趋势预测模型为：
        
        <div>
        $$
        \begin{equation}
        \hat{y}_{t+T}=kT+b, T=1,2,... 
        \end{equation}
        $$
        </div>
        
        其中，$t$表示当前时期，$T$为由$t$至预测期的间隔期数，$k，b$为平滑系数，分表示斜率和截距。
        
        类似二次移动平均法的线性趋势模型推导过程，可得二次指数平滑的线性趋势模型：
        
        <div>
        $$
        \begin{equation}
        \begin{aligned}
        \begin{cases}
        k=\frac{\alpha}{1-\alpha}(S^1_t-S^2_t) \\
        b=2S^1_t-S^2_t
        \end{cases}
        \end{aligned}
        \end{equation}
        $$
        </div>
        
        总结，二次指数平滑法一种既能反映趋势变化，又可以有效的分离出周期变动的预测方法。因此，适用于同时存在线性趋势和周期波动的时间序列
        
- 三次指数平滑法
    
    当时间序列的变动表现为二次曲线趋势时，则需要使用三次指数平滑法
    
    当时间序列的变动表现为二次曲线趋势时，则需要用三次指数平滑法。三次指数平滑法是在二次指数平滑的基础上，在进行一次平滑。其计算公式为：
    
    <div>
    $$
    \begin{equation}
    \begin{aligned}
    \begin{cases}
    S^1_t=\alpha y_t+(1-\alpha)S^1_{t-1} \\
    S^2_t=\alpha S^1_t+(1-\alpha)S^2_{t-1} \\
    S^3_t=\alpha S^2_t+(1-\alpha)S^3_{t-1} \\
    \end{cases}
    \end{aligned}
    \end{equation}
    $$
    </div>
    
    其中，$S^1_t,S^2_t,S^3_t$分别为一次指数平滑值，二次指数平滑值和三次指数平滑值。
    
    设时间序列$\{y_t\}$从某个时期开始呈现二次曲线趋势，且变动趋势会延续到未来，其二次曲线趋势预测模型为：
    
    <div>
    $$
    \begin{equation}
    \hat{y}_{t+T}=kT^2+aT+b,\quad T=1,2,...
    \end{equation}
    $$
    </div>
    
    其中，$t$表示当前时期，$T$为由$t$至预测期的间隔期数，$k，c，b$为平滑系数。
    
    三次指数平滑法的预测模型为：
    
    <div>
    $$
    \begin{equation}
    \begin{aligned}
    \begin{cases}
    k=\frac{\alpha^2}{2(1-\alpha)^2}(S^1_t-2S^2_t+S^3_t) \\
    a=\frac{\alpha}{2(1-\alpha)^2}[(6-5\alpha)S^1_t-2(5-4\alpha)S^2_t+(4-3\alpha)S^3_t] \\
    b=3S^1_t-3S^2_t+S^3_t
    \end{cases}
    \end{aligned}
    \end{equation}
    $$
    </div>
    

### 总结

指数平滑预测模型是以时刻$t$为起点，综合历史序列的信息对未来进行预测。选择合适的加权系数$\alpha$是提高预测精度的关键。一般的原则是：

1. 如果序列的基本趋势比较平稳，预测偏差由随机因素造成的，则$\alpha$的值应取小一点，以减少修正幅度，是预测模型能包含更多的历史数据。
2. 如果预测模板的基本趋势已经发生系统地变化，则 $\alpha$的值应取大一点，这样可以偏重新观测值对原预测模型进行大幅度修正，使预测模型适应预测目标的新变化。